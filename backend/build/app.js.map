{"version":3,"sources":["../src/app.js"],"names":["production","process","env","NODE_ENV","require","config","app","server","corsOptions","origin","CORSwhitelist","credentials","use","express","json","urlencoded","extended","applyMiddleware","path","cors","indexRouter","req","res","next","err","locals","message","error","get","status","port","PORT","listen","console","log"],"mappings":";;;;;;;;;AAQA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA,IAAMA,UAAU,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA5C,C,CAEA;;AACA,IAAI,CAACH,UAAL,EAAiBI,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB;AAEjB,IAAMC,GAAG,GAAG,0BAAZ;AAEA,IAAMC,MAAM,GAAG,+BAAf;AAEA,IAAMC,WAAW,GAAG;AAAEC,EAAAA,MAAM,EAAEC,qBAAV;AAAyBC,EAAAA,WAAW,EAAE;AAAtC,CAApB;AAEAL,GAAG,CAACM,GAAJ,CAAQ,sBAAKJ,WAAL,CAAR;AACAF,GAAG,CAACM,GAAJ,CAAQ,wBAAO,KAAP,CAAR;AACAN,GAAG,CAACM,GAAJ,CAAQC,oBAAQC,IAAR,EAAR;AACAR,GAAG,CAACM,GAAJ,CAAQC,oBAAQE,UAAR,CAAmB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAnB,CAAR;AACAV,GAAG,CAACM,GAAJ,CAAQ,+BAAR;AAEAL,MAAM,CAACU,eAAP,CAAuB;AAAEX,EAAAA,GAAG,EAAHA,GAAF;AAAOY,EAAAA,IAAI,EAAE,MAAb;AAAqBC,EAAAA,IAAI,EAAEX;AAA3B,CAAvB;AAEAF,GAAG,CAACM,GAAJ,CAAQ,GAAR,EAAaQ,kBAAb,E,CAEA;;AACAd,GAAG,CAACM,GAAJ,CAAQ,UAACS,GAAD,EAAMC,GAAN,EAAWC,IAAX;AAAA,SAAoBA,IAAI,CAAC,4BAAY,GAAZ,CAAD,CAAxB;AAAA,CAAR,E,CAEA;;AACAjB,GAAG,CAACM,GAAJ,CAAQ,UAACY,GAAD,EAAMH,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,EAAyB;AAC/B;AACAD,EAAAA,GAAG,CAACG,MAAJ,CAAWC,OAAX,GAAqBF,GAAG,CAACE,OAAzB;AACAJ,EAAAA,GAAG,CAACG,MAAJ,CAAWE,KAAX,GAAmBN,GAAG,CAACf,GAAJ,CAAQsB,GAAR,CAAY,KAAZ,MAAuB,aAAvB,GAAuCJ,GAAvC,GAA6C,EAAhE,CAH+B,CAK/B;;AACAF,EAAAA,GAAG,CAACO,MAAJ,CAAWL,GAAG,CAACK,MAAJ,IAAc,GAAzB;AACAP,EAAAA,GAAG,CAACR,IAAJ,CAAS;AAAEY,IAAAA,OAAO,EAAEF,GAAG,CAACE,OAAf;AAAwBC,IAAAA,KAAK,EAAEH;AAA/B,GAAT;AACD,CARD,E,CAUA;;AACA,IAAIxB,UAAJ,EAAgB;AACd,MAAM8B,IAAI,GAAG7B,OAAO,CAACC,GAAR,CAAY6B,IAAZ,IAAoB,MAAjC;AAEAzB,EAAAA,GAAG,CAAC0B,MAAJ,CAAW;AAAEF,IAAAA,IAAI,EAAJA;AAAF,GAAX,EAAqB,UAAAN,GAAG,EAAI;AAC1B,QAAIA,GAAJ,EAAS,MAAMA,GAAN;AAETS,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCJ,IAArC;AACD,GAJD;AAKD;;eAEcxB,G","sourcesContent":["/*\r\n\r\n! must re-build server before pushing to vercel\r\n? and start script\r\n* npm run build\r\n\r\n*/\r\n\r\nimport createError from 'http-errors';\r\nimport express from 'express';\r\nimport cookieParser from 'cookie-parser';\r\nimport logger from 'morgan';\r\nimport cors from 'cors';\r\n\r\nimport { CORSwhitelist } from './config.js';\r\nimport apolloServer from './graphql/apolloServer';\r\nimport indexRouter from './rest/routes';\r\n\r\nconst production = process.env.NODE_ENV === 'production';\r\n\r\n// in production, env vars are defined on the host\r\nif (!production) require('dotenv').config();\r\n\r\nconst app = express();\r\n\r\nconst server = apolloServer();\r\n\r\nconst corsOptions = { origin: CORSwhitelist, credentials: true };\r\n\r\napp.use(cors(corsOptions));\r\napp.use(logger('dev'));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(cookieParser());\r\n\r\nserver.applyMiddleware({ app, path: '/gql', cors: corsOptions });\r\n\r\napp.use('/', indexRouter);\r\n\r\n// catch 404 and forward to error handler\r\napp.use((req, res, next) => next(createError(404)));\r\n\r\n// error handler\r\napp.use((err, req, res, next) => {\r\n  // set locals, only providing error in development\r\n  res.locals.message = err.message;\r\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\r\n\r\n  // return the error\r\n  res.status(err.status || 500);\r\n  res.json({ message: err.message, error: err });\r\n});\r\n\r\n// ./bin/www.js file doesn't work on vercel\r\nif (production) {\r\n  const port = process.env.PORT || '8008';\r\n\r\n  app.listen({ port }, err => {\r\n    if (err) throw err;\r\n\r\n    console.log('Server ready on port:', port);\r\n  });\r\n}\r\n\r\nexport default app;\r\n"],"file":"app.js"}